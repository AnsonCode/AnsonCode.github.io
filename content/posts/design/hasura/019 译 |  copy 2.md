---
title: "019 译 | 使用Serverless Functions 和 Postgres 构建有状态应用"
date: 2022-02-18T22:22:45+08:00
tags: ["技术翻译", "Hasura"]
categories: ["研发提效"]
featured_image:
description:
draft: true
---

翻译自：[Building Stateful Apps with Serverless Functions and Postgres](https://hasura.io/blog/building-stateful-apps-using-serverless-postgres-and-hasura/)

![How should your serverless functions interface with a database to manage application state?](https://gitee.com/caoyanbin/picgo/raw/master/img/20220316215809.png)

本文探索当在无服务函数中写业务逻辑时，处理应用状态的不同的方式。当谈论这些不同的方法时，我们将主要使用 Postgres 作为数据库，并且经常使用 Hasura 作为介于无服务函数和 Postgres 数据库之间的粘合剂。然而，本文的观点是通用的，并且可以应用到你最喜欢的数据库解决方案上。

- 方法#1：直接从无服务函数连接到 Postgres 上
- 方法#2：在无服务函数中使用 BaaS APIs
- 方法#3：在 Postgres 事件中使用丰富的事件负载触发无服务函数
- 方法#4：组合上述方法并且使用 Postgres 编排工作流与驱动状态转变的无服务函数

## 介绍

Serverless 平台不允许开发者编写维持长期状态的代码。这是因为 Serverless 运行时按需启动，并且生命周期很短，例如：在请求完成时释放所有的资源。

这是几个例子你不能采用写普通 API 服务时相同的方式，并且认为理所当然：

1. 直接写入磁盘，像保存文件到文件夹
2. 保持跨多个请求信息的全局变量，例如一个跟踪该 API 服务已经精力多少次请求的计数器
3. 一个 API 服务维持数据库的连接池 ，甚至在没有请求时

本文，我们探索一些真实世界用例的模式，将在使用无服务函数构建下一个应用中帮到你。让我们一个接一个的谈到他们！

## 1.直接连接 Postgres

对于服务端应用最常用的存储应用状态的方式是使用数据库。然而，直接从无服务函数原生连接到数据库不是明智的决定，因为当你突然调用 1000 无服务函数时，数据库不能突然扩容创建 1000 数据库连接。

![](https://gitee.com/caoyanbin/picgo/raw/master/img/20220316225409.png)

这儿有一些从无服务函数连接到 Postgres 去读写数据或运行数据库事务的最佳实践：

1. 创建连接
